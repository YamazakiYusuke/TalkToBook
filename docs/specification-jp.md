# TalkToBook アプリケーション仕様書

## 1. エグゼクティブサマリー

### 1.1 問題提起
私の祖母は本を書いていますが、作業の困難さにより進捗が滞っています。手書きやタイピングは高齢者にとって大きな身体的負担となり、創作活動を妨げています。

### 1.2 ソリューション概要
「TalkToBook」というスマートフォンアプリを開発することで、この課題を解決します。このアプリは話した内容をテキストとして記録し、文書として整理します。音声入力により、高齢者でも簡単にテキストを作成・編集できるようになります。

### 1.3 主な利点
- 音声入力による書く作業の身体的負担の軽減
- シンプルで使いやすいインターフェース
- 自動保存機能による作業内容の保護
- 音声コマンドによる操作の簡素化

## 2. ユーザー要件

### 2.1 ターゲットユーザー
- **主要ユーザー**: 本や文書を書きたい高齢者（特に65歳以上）
- **ユーザー特性**:
  - タイピングや手書きが困難または負担
  - 基本的なスマートフォン操作が可能
  - 視力低下や手の震えなどの身体的制約がある可能性
  - 技術的知識が限定的

### 2.2 ユーザーペルソナ
**主要ペルソナ: 田中花子さん（75歳）**
- 自伝を書きたい
- 長時間のタイピングで手が疲れる
- スマートフォンで家族と連絡を取っている
- 小さい文字が見えにくい

### 2.3 ユーザーストーリー
1. ユーザーとして、話した内容が自動的にテキストに変換されることを望む
2. ユーザーとして、大きなボタンでアプリを簡単に操作したい
3. ユーザーとして、作業内容が自動的に保存されることで安心したい
4. ユーザーとして、音声コマンドでアプリを操作したい
5. ユーザーとして、オフラインでアプリが使用できない場合は明確に通知してほしい

### 2.4 ユースケース
1. **音声録音と変換**
   - ユーザーが録音ボタンを押す
   - 話した内容を録音
   - 自動的にテキストに変換
   - 画面に結果を表示

2. **テキスト編集**
   - 変換されたテキストを確認
   - 必要に応じて音声で修正を指示
   - テキストを整理・編集

3. **文書管理**
   - 複数の録音セッションを1つの文書にまとめる
   - 章や段落を整理
   - 完成した文書を保存

## 3. 機能要件

### 3.1 コア機能

#### 3.1.1 音声録音
- ワンタップで録音開始/停止
- 録音中の視覚的フィードバック（大きな録音インジケーター）
- 録音時間の表示
- 一時停止と再開機能

#### 3.1.2 音声テキスト変換
- OpenAI Whisper APIを使用した高精度音声認識
- 日本語に最適化された変換
- リアルタイムまたはバッチ処理による変換
- 話者適応による変換精度の向上

#### 3.1.3 テキスト整理
- 自動的な段落分け
- 章・節の作成機能
- テキストの並び替え
- シンプルな編集機能（削除、挿入、修正）

#### 3.1.4 自動保存
- 5秒ごとの自動保存
- 変更検出時の即時保存
- 保存状態の視覚的表示
- データ復旧機能

#### 3.1.5 音声コマンド
- 「録音開始」「録音停止」などの基本コマンド
- 「次の章」「戻る」などのナビゲーションコマンド
- 「保存」「読み上げ」などの操作コマンド

### 3.2 ユーザーインターフェース要件
- 最小フォントサイズ: 18pt
- 最小ボタンサイズ: 48dp x 48dp
- 高コントラストな配色
- シンプルなアイコンとラベルの併用
- 音声フィードバック機能

### 3.3 アクセシビリティ要件
- TalkBack対応
- 拡大表示対応
- 音声ガイダンス
- 振動フィードバック
- 色覚障害に配慮した配色

## 4. 非機能要件

### 4.1 パフォーマンス要件
- 音声録音遅延: 最大100ms
- テキスト変換時間: 録音時間の2倍以内
- アプリ起動時間: 3秒以内
- 自動保存完了: 1秒以内

### 4.2 セキュリティ要件
- ローカルストレージの暗号化
- APIキーの安全な管理
- ユーザーデータのプライバシー保護
- 一時的な音声ファイルの削除

### 4.3 ユーザビリティ要件
- 主要機能へのアクセスは3タップ以内
- エラーメッセージは平易な日本語で表示
- 操作の取り消し機能
- チュートリアル機能

### 4.4 信頼性要件
- クラッシュ率: 0.1%以下
- データ損失率: 0%（自動保存により）
- ネットワーク接続の監視と適切なエラーハンドリング

## 5. 技術仕様

### 5.1 プラットフォームと技術スタック
- **プラットフォーム**: Android（最小APIレベル24 / Android 7.0）
- **プログラミング言語**: Kotlin
- **アーキテクチャ**: MVVM（Model-View-ViewModel）
- **UIフレームワーク**: Jetpack Compose
- **依存性注入**: Hilt
- **データベース**: Room
- **ネットワーク**: Retrofit + OkHttp

### 5.2 システムアーキテクチャ
```
┌─────────────────┐
│  Presentation   │  - Activities/Fragments
│     Layer       │  - ViewModels
│                 │  - Composables
├─────────────────┤
│   Domain        │  - Use Cases
│    Layer        │  - Domain Models
│                 │  - Repository Interfaces
├─────────────────┤
│    Data         │  - Repository実装
│    Layer        │  - ローカルデータソース（Room）
│                 │  - リモートデータソース（API）
└─────────────────┘
```

### 5.3 API統合

#### 5.3.1 OpenAI API仕様
- **エンドポイント**: 音声テキスト変換用Whisper API
- **認証**: Bearerトークン
- **リクエスト形式**: 
  ```
  - 音声形式: MP3、M4A、WAV
  - 最大ファイルサイズ: 25MB
  - 言語: ja（日本語）
  ```
- **レスポンス処理**: 変換されたテキストを含むJSON
- **エラーコード**: 
  - 401: 無効なAPIキー
  - 429: レート制限超過
  - 500: サーバーエラー

#### 5.3.2 エラーハンドリング
- リトライ用の指数バックオフ
- 保留中の変換用オフラインキュー
- ユーザーフレンドリーなエラーメッセージ
- 可能な場合はキャッシュ結果へのフォールバック

### 5.4 データストレージ

#### 5.4.1 ローカルストレージスキーマ
```kotlin
@Entity
data class Recording(
    @PrimaryKey val id: String,
    val timestamp: Long,
    val audioFilePath: String,
    val transcribedText: String?,
    val status: TranscriptionStatus
)

@Entity
data class Document(
    @PrimaryKey val id: String,
    val title: String,
    val createdAt: Long,
    val updatedAt: Long,
    val content: String
)

@Entity
data class Chapter(
    @PrimaryKey val id: String,
    val documentId: String,
    val orderIndex: Int,
    val title: String,
    val content: String
)
```

#### 5.4.2 将来のクラウド移行計画
- フェーズ1: Roomを使用したローカルSQLite
- フェーズ2: Firebase Firestoreとの同期
- フェーズ3: オフラインキャッシュ付き完全クラウドストレージ
- データ移行ツールと後方互換性

### 5.5 ネットワーク要件
- **接続性**: すべての操作に必要
- **最小帯域幅**: 1 Mbps
- **オフライン検出**: 即座のUIフィードバック
- **接続監視**: リアルタイムステータス更新

## 6. ユーザーインターフェースデザイン

### 6.1 デザイン原則
1. **シンプルさ優先**: 最小限の要素で最大限の機能性
2. **大きなタッチターゲット**: すべての対話可能要素は48dp以上
3. **高コントラスト**: WCAG AA準拠のコントラスト比
4. **明確なフィードバック**: すべての操作に対する即座のフィードバック
5. **一貫したレイアウト**: 予測可能なUI要素の配置

### 6.2 画面レイアウト

#### 6.2.1 メイン画面
- 大きな録音ボタン（画面の1/3を占める）
- 録音履歴リスト（大きなフォント）
- シンプルなナビゲーションバー

#### 6.2.2 録音画面
- 録音状態の明確な表示
- 波形ビジュアライザー
- 大きな停止ボタン
- 経過時間表示

#### 6.2.3 テキスト表示画面
- 読みやすいフォントとサイズ
- シンプルな編集ツールバー
- 音声コマンドボタン

### 6.3 ナビゲーションフロー
```
メイン画面 → 録音画面 → 処理中画面 → テキスト表示画面
     ↑                                        ↓
     └──────────── 文書リスト ←──────────────────┘
```

### 6.4 シニアフレンドリーなデザイン要素
- アイコンとテキストラベルの併用
- 最小限のアニメーション
- 誤操作防止の確認ダイアログ
- 画面間の明確な遷移
- 各画面にヘルプボタンを配置

## 7. データ管理

### 7.1 データモデル
- **音声データ**: 一時的な音声ファイル（録音後削除）
- **テキストデータ**: 永続的なテキストデータ
- **メタデータ**: タイムスタンプ、編集履歴
- **ユーザー設定**: フォントサイズ、カラーテーマ

### 7.2 ストレージ戦略
- 音声ファイル: 内部ストレージの一時ディレクトリ
- テキストデータ: Roomデータベース
- 設定: SharedPreferences
- キャッシュ: 最大100MB

### 7.3 バックアップとリカバリ
- 自動バックアップ: 毎日
- 手動バックアップ: いつでも利用可能
- リストア機能: シンプルなUI
- データエクスポート: テキストファイル形式

## 8. テスト要件

### 8.1 単体テスト
- ViewModelsロジックテスト
- Repositoryレイヤーテスト
- Use Casesテスト
- カバレッジ目標: 80%以上

## 9. デプロイメントとメンテナンス

### 9.1 デプロイメント戦略
- Google Play Store経由での配布
- 段階的ロールアウト（5% → 25% → 50% → 100%）
- A/Bテストによる機能検証

### 9.2 アップデート機構
- 自動アップデート推奨
- 重要アップデートの通知
- アップデート後のチュートリアル

### 9.3 サポートとメンテナンス
- アプリ内ヘルプセンター
- よくある質問（FAQ）
- メールサポート
- 定期的なバグ修正リリース

## 10. 将来の機能拡張

### 10.1 クラウドストレージ統合
- フェーズ1: オプションのクラウドバックアップ
- フェーズ2: リアルタイム同期
- フェーズ3: マルチデバイス対応
- フェーズ4: 共同編集機能

### 10.2 追加機能
- PDF/EPUB出力
- 画像挿入機能
- 読み上げ機能の強化
- AIによる文章校正支援
- ボイスメモ機能

### 10.3 プラットフォーム拡張
- iOS版の開発
- Web版の検討
- タブレット最適化

## 11. 付録

### 11.1 用語集
- **Speech-to-Text (STT)**: 音声認識技術
- **自動保存**: 自動的に保存する機能
- **音声コマンド**: 音声で操作するコマンド
- **アクセシビリティ**: 障害のある人を含むすべてのユーザーにとっての使いやすさ

### 11.2 参考文献
- Androidアクセシビリティガイドライン
- OpenAI APIドキュメント
- Material Designアクセシビリティガイドライン
- WCAG 2.1ガイドライン

### 11.3 改訂履歴
- v1.0 (2024-12-06): 初版作成
- v1.1 (2024-12-06): 英語翻訳完了
- v1.2 (2024-12-13): 日本語版作成