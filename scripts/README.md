# TalkToBook Test Scripts

This directory contains automated test execution scripts based on the test documentation in `docs/testing/`.

## Available Scripts

### 1. `run-tests.sh` - Comprehensive Test Suite

**Purpose:** Full-featured test execution with reporting and configuration options.

**Usage:**
```bash
# Run all tests with default settings
./scripts/run-tests.sh

# Run with clean build and verbose output
./scripts/run-tests.sh -c -v

# Run specific test class
./scripts/run-tests.sh -t "ChapterTest"

# Run only unit tests (skip lint)
./scripts/run-tests.sh --no-lint

# Run only lint checks (skip unit tests)
./scripts/run-tests.sh --no-unit-tests
```

**Features:**
- ✅ Environment setup and validation
- ✅ Unit test execution
- ✅ Lint checks
- ✅ Report generation and collection
- ✅ Colored output and progress indicators
- ✅ Comprehensive error handling
- ✅ Summary report generation

**Options:**
- `-u, --unit-tests`: Run unit tests (default: true)
- `-l, --lint`: Run lint checks (default: true)
- `-c, --clean`: Run clean before tests (default: false)
- `-r, --reports`: Generate reports (default: true)
- `-v, --verbose`: Verbose output
- `-t, --test CLASS`: Run specific test class
- `--no-unit-tests`: Skip unit tests
- `--no-lint`: Skip lint checks
- `--no-reports`: Skip report generation

### 2. `quick-test.sh` - Rapid Testing

**Purpose:** Fast test execution for development workflow.

**Usage:**
```bash
# Run all tests quickly
./scripts/quick-test.sh

# Run only unit tests
./scripts/quick-test.sh unit

# Run only lint checks
./scripts/quick-test.sh lint
```

**Features:**
- ⚡ Minimal overhead
- 🎯 Focused execution
- 📱 Development-friendly

### 3. `test-specific.sh` - Targeted Test Execution

**Purpose:** Run specific test classes with detailed output.

**Usage:**
```bash
# Show available test classes
./scripts/test-specific.sh help

# Run specific test
./scripts/test-specific.sh ChapterTest
./scripts/test-specific.sh DocumentTest
./scripts/test-specific.sh RecordingTest

# Run with full class name
./scripts/test-specific.sh com.example.talktobook.domain.model.ChapterTest
```

**Features:**
- 🎯 Single test class execution
- 📋 Available test discovery
- 📊 Detailed result reporting

## Environment Requirements

All scripts automatically configure the Android development environment:

```bash
export ANDROID_HOME="$HOME/android"
export ANDROID_SDK_ROOT="$ANDROID_HOME"
export JAVA_HOME="/usr/lib/jvm/java-17-openjdk-amd64"
export PATH="$JAVA_HOME/bin:$ANDROID_HOME/cmdline-tools/latest/bin:$ANDROID_HOME/platform-tools:$PATH"
```

### Prerequisites
- ✅ WSL Ubuntu with Android SDK installed natively
- ✅ OpenJDK 17
- ✅ Gradle 8.10.2+
- ✅ Android SDK Platform 35
- ✅ Build Tools 35.0.0

## Output and Reports

### Report Locations

**Generated by `run-tests.sh`:**
- Test reports: `test-reports/[timestamp]/`
- HTML reports: `app/build/reports/tests/testDebugUnitTest/index.html`
- XML results: `app/build/test-results/testDebugUnitTest/*.xml`
- Lint reports: `app/build/reports/lint-results-*.html`
- Summary: `test-reports/[timestamp]/test-summary.md`
- Execution logs: `test-reports/test-output-[timestamp].log`

**Example directory structure:**
```
test-reports/
├── 20250613_175030/
│   ├── test-summary.md
│   ├── testDebugUnitTest/
│   │   └── index.html
│   ├── test-results/
│   │   └── testDebugUnitTest/
│   │       ├── TEST-ChapterTest.xml
│   │       └── TEST-DocumentTest.xml
│   └── lint-results-debug.html
└── test-output-20250613_175030.log
```

### Summary Report Example

```markdown
# TalkToBook Test Execution Summary

**Execution Date:** Fri Jun 13 17:50:30 UTC 2025
**Environment:** WSL Ubuntu + Android SDK

## Test Results
- Total Tests: 19
- Failed Tests: 0
- Success Rate: 100%

## Generated Files
- Test Reports: `app/build/reports/tests/`
- Test Results: `app/build/test-results/`
- Lint Reports: `app/build/reports/lint-results-*.*`
```

## Integration with CI/CD

### GitHub Actions Example
```yaml
- name: Run comprehensive tests
  run: ./scripts/run-tests.sh -v --no-reports

- name: Upload test reports
  uses: actions/upload-artifact@v3
  with:
    name: test-reports
    path: test-reports/
```

### Development Workflow Integration
```bash
# Pre-commit hook
./scripts/quick-test.sh

# During development
./scripts/test-specific.sh ChapterTest

# Before pull request
./scripts/run-tests.sh -c -v
```

## Error Handling

All scripts include comprehensive error handling:

- ❌ **Environment validation**: Checks for required tools
- ❌ **Graceful failures**: Clear error messages with color coding
- ❌ **Exit codes**: Proper exit codes for CI/CD integration
- ❌ **Trap handling**: Cleanup on script interruption

### Common Error Scenarios

1. **Missing Java 17**
   ```
   [ERROR] Java not found. Please install OpenJDK 17.
   ```

2. **Android SDK not found**
   ```
   [ERROR] ADB not found. Please check Android SDK installation.
   ```

3. **Test failures**
   ```
   [ERROR] Unit tests failed
   ```

## Customization

### Adding New Test Types

To add instrumented tests:

1. Modify `run-tests.sh`:
```bash
# Add new option
RUN_INSTRUMENTED_TESTS=false

# Add new function
run_instrumented_tests() {
    if [ "$RUN_INSTRUMENTED_TESTS" = true ]; then
        print_header "Running Instrumented Tests"
        ./gradlew connectedAndroidTest
    fi
}
```

2. Update argument parsing and main function.

### Custom Report Formats

To add JSON report generation:

```bash
generate_json_report() {
    local json_file="$REPORTS_DIR/$TIMESTAMP/test-results.json"
    # Parse XML and generate JSON
    python3 scripts/xml-to-json.py "$json_file"
}
```

## Troubleshooting

### Script Permissions
```bash
chmod +x scripts/*.sh
```

### WSL Path Issues
```bash
# Ensure scripts are run from project root
cd /mnt/c/Users/yusuk/workspace/android/TalkToBook
./scripts/run-tests.sh
```

### Environment Issues
```bash
# Check environment manually
./scripts/run-tests.sh -v
```

For detailed troubleshooting, see `docs/testing/wsl-android-setup-troubleshooting.md`.

## Contributing

When adding new scripts:

1. Follow the existing naming convention
2. Include comprehensive help text
3. Add error handling and validation
4. Update this README
5. Test on clean WSL environment